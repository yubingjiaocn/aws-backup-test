# AWS Backup for EKS åŠŸèƒ½æµ‹è¯•å¥—ä»¶

ç”¨äºæµ‹è¯• AWS Backup å¯¹ Amazon EKS é›†ç¾¤çš„å¤‡ä»½å’Œæ¢å¤èƒ½åŠ›ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
aws-backup-test/
â”œâ”€â”€ æµ‹è¯•æŒ‡å—.md                    # ğŸ“– å®Œæ•´æµ‹è¯•æ­¥éª¤(ä»è¿™é‡Œå¼€å§‹!)
â”œâ”€â”€ terraform/                     # Terraform åŸºç¡€è®¾æ–½ä»£ç 
â”‚   â”œâ”€â”€ main.tf                   # VPC, IAM, EFS é…ç½®
â”‚   â”œâ”€â”€ variables.tf              # å˜é‡å®šä¹‰
â”‚   â””â”€â”€ README.md                 # Terraform ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ eksctl-config/                 # eksctl é›†ç¾¤é…ç½®
â”‚   â”œâ”€â”€ cluster.yaml              # æ¨¡æ¿é…ç½®
â”‚   â””â”€â”€ export-tf-outputs.sh      # è‡ªåŠ¨ç”Ÿæˆé…ç½®è„šæœ¬
â”œâ”€â”€ scripts/                       # è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ utils.sh                  # å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ 01-create-backup.sh       # åˆ›å»ºå¤‡ä»½
â”‚   â”œâ”€â”€ 02-restore-to-new-cluster.sh   # æ¢å¤åˆ°æ–°é›†ç¾¤
â”‚   â”œâ”€â”€ 03-enable-managed-addons.sh    # å¯ç”¨ CSI Drivers
â”‚   â”œâ”€â”€ 04-install-karpenter.sh   # å®‰è£… Karpenter
â”‚   â”œâ”€â”€ 05-verify-restore.sh      # éªŒè¯æ¢å¤ç»“æœ
â”‚   â””â”€â”€ create-iam-roles.sh       # åˆ›å»º IAM è§’è‰²(å¤‡ç”¨)
â””â”€â”€ test-workloads/                # æµ‹è¯•å·¥ä½œè´Ÿè½½
    â”œâ”€â”€ namespace.yaml            # æµ‹è¯•å‘½åç©ºé—´
    â”œâ”€â”€ statefulset-ebs.yaml      # StatefulSet + EBS
    â”œâ”€â”€ deployment-efs.yaml       # Deployment + EFS
    â””â”€â”€ karpenter-nodepool.yaml   # Karpenter é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

**å®Œæ•´æµ‹è¯•æŒ‡å—è¯·æŸ¥çœ‹**: [æµ‹è¯•æŒ‡å—.md](./æµ‹è¯•æŒ‡å—.md)

### å¿«é€Ÿæ­¥éª¤

```bash
# 1. åˆ›å»ºåŸºç¡€è®¾æ–½
cd terraform && terraform init && terraform apply -auto-approve

# 2. åˆ›å»º EKS é›†ç¾¤
cd .. && ./eksctl-config/export-tf-outputs.sh 1.32
eksctl create cluster -f eksctl-config/cluster-generated.yaml

# 3. å¯ç”¨ Add-on å’Œéƒ¨ç½²å·¥ä½œè´Ÿè½½
CLUSTER_NAME=$(cd terraform && terraform output -raw cluster_name)
./scripts/03-enable-managed-addons.sh $CLUSTER_NAME
kubectl apply -f test-workloads/namespace.yaml
kubectl apply -f test-workloads/statefulset-ebs.yaml

# 4. åˆ›å»ºå¤‡ä»½
./scripts/01-create-backup.sh $CLUSTER_NAME

# 5. æ¢å¤æµ‹è¯•
./scripts/02-restore-to-new-cluster.sh \
  --recovery-point-arn <ä½ çš„ ARN> \
  --cluster-name eks-rollback-v132 \
  --eks-version 1.32

# 6. éªŒè¯
./scripts/03-enable-managed-addons.sh eks-rollback-v132
./scripts/04-install-karpenter.sh eks-rollback-v132
./scripts/05-verify-restore.sh eks-rollback-v132
```

## ğŸ¯ æµ‹è¯•åœºæ™¯

### åœºæ™¯ä¸€: EKS ç‰ˆæœ¬å›æ»š
æµ‹è¯•ä»å¤‡ä»½æ¢å¤åˆ°æ–°é›†ç¾¤,æ¨¡æ‹Ÿå‡çº§å¤±è´¥åçš„ç‰ˆæœ¬å›æ»šã€‚

**å…³é”®ç‚¹**:
- âœ… å¤‡ä»½åœ¨ v1.32 åˆ›å»º
- âœ… æ¢å¤åˆ°æ–°çš„ v1.32 é›†ç¾¤
- âœ… éªŒè¯æ‰€æœ‰èµ„æºå’Œæ•°æ®

### åœºæ™¯äºŒ: æ“ä½œé”™è¯¯æ¢å¤
æµ‹è¯•ä»è¯¯åˆ é™¤ä¸­æ¢å¤èµ„æºã€‚

**å…³é”®ç‚¹**:
- âœ… æ¨¡æ‹Ÿè¯¯åˆ é™¤å‘½åç©ºé—´å’Œèµ„æº
- âœ… ä½¿ç”¨å¤‡ä»½æ¢å¤
- âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§

## â±ï¸ æ—¶é—´å’Œæˆæœ¬

- **æµ‹è¯•æ—¶é—´**: 2-4 å°æ—¶
- **é¢„ä¼°æˆæœ¬**: $1-2 ç¾å…ƒ (æµ‹è¯•åç«‹å³æ¸…ç†)

## ğŸ“¦ å‰ç½®æ¡ä»¶

- AWS CLI (å·²é…ç½®)
- kubectl
- eksctl
- Terraform >= 1.0
- jq
- Helm

## ğŸ§¹ æ¸…ç†èµ„æº

```bash
# åˆ é™¤é›†ç¾¤
eksctl delete cluster --name <é›†ç¾¤åç§°> --region us-west-2

# åˆ é™¤åŸºç¡€è®¾æ–½
cd terraform && terraform destroy -auto-approve
```

## ğŸ“– æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Terraform                   â”‚
â”‚  - VPC + å­ç½‘ + NAT ç½‘å…³            â”‚
â”‚  - IAM è§’è‰² (Pod Identity)         â”‚
â”‚  - EFS æ–‡ä»¶ç³»ç»Ÿ                     â”‚
â”‚  - å®‰å…¨ç»„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           eksctl                     â”‚
â”‚  - EKS é›†ç¾¤                         â”‚
â”‚  - æ‰˜ç®¡èŠ‚ç‚¹ç»„                       â”‚
â”‚  - Pod Identity Agent               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AWS Backup                    â”‚
â”‚  - è‡ªåŠ¨å¤‡ä»½ EKS èµ„æº                â”‚
â”‚  - æ¢å¤åˆ°æ–°é›†ç¾¤æˆ–åŒä¸€é›†ç¾¤           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ ç‰¹æ€§

- âœ… ä½¿ç”¨ **Pod Identity** è€Œé IRSA (æ›´ç®€å•)
- âœ… **å• NAT ç½‘å…³** èŠ‚çœæˆæœ¬
- âœ… **Terraform + eksctl** åˆ†ç¦»æ¶æ„
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–çš„æµ‹è¯•è„šæœ¬
- âœ… ä¸­æ–‡æ–‡æ¡£

## âš ï¸ é‡è¦æç¤º

1. **ç‰ˆæœ¬å›æ»š**: å¿…é¡»æ¢å¤åˆ°æ–°é›†ç¾¤,æ— æ³•åœ¨åŒä¸€é›†ç¾¤é™çº§
2. **æ‰‹åŠ¨æ­¥éª¤**: CSI Drivers å’Œ Karpenter Controller éœ€è¦æ‰‹åŠ¨é…ç½®
3. **éç ´åæ€§**: AWS Backup æ¢å¤ä¸ä¼šè¦†ç›–ç°æœ‰å¯¹è±¡
4. **ç«‹å³æ¸…ç†**: æµ‹è¯•å®Œæˆåç«‹å³åˆ é™¤èµ„æºä»¥é¿å…è´¹ç”¨

## ğŸ“ é—®é¢˜æ’æŸ¥

å¸¸è§é—®é¢˜è¯·å‚è€ƒ [æµ‹è¯•æŒ‡å—.md](./æµ‹è¯•æŒ‡å—.md) ä¸­çš„"æ•…éšœæ’æŸ¥"ç« èŠ‚ã€‚

---

**å¼€å§‹æµ‹è¯•**: è¯·é˜…è¯» [æµ‹è¯•æŒ‡å—.md](./æµ‹è¯•æŒ‡å—.md) ğŸ“–
